class o{constructor(e,t){this.model=e,this.view=t}async init(){this.view.onStoryCardClick(e=>this.handleStoryClick(e)),this.view.onRemoveFromFavorites(e=>this.handleRemoveFromFavorites(e)),this.view.onClearFavorites(()=>this.handleClearFavorites()),this.view.onExportFavorites(()=>this.handleExportFavorites()),await this.loadFavorites()}async loadFavorites(){try{this.view.showLoading();const e=await this.model.getFavorites();this.view.renderFavorites(e)}catch(e){console.error("Error loading favorites:",e),this.view.showError("Gagal memuat cerita favorit.")}}async handleStoryClick(e){try{const t=await window.indexedDBService.getStoryById(e);t&&this.view.showStoryDetail(t)}catch(t){console.error("Error fetching story details:",t),this.view.showAlert("Gagal memuat detail cerita")}}async handleRemoveFromFavorites(e){if(this.view.confirmAction("Hapus cerita ini dari favorit?"))try{await this.model.removeFromFavorites(e),await this.loadFavorites(),this.view.showSuccessMessage("Cerita dihapus dari favorit")}catch(t){console.error("Error removing from favorites:",t),this.view.showAlert("Gagal menghapus cerita dari favorit.")}}async handleClearFavorites(){const e=await this.model.getFavorites();if(e.length===0){this.view.showAlert("Tidak ada favorit untuk dihapus.");return}if(this.view.confirmAction(`Hapus semua ${e.length} cerita favorit? Tindakan ini tidak dapat dibatalkan.`))try{for(const t of e)await this.model.removeFromFavorites(t.id);await this.loadFavorites(),this.view.showSuccessMessage("Semua favorit telah dihapus.")}catch(t){console.error("Error clearing favorites:",t),this.view.showAlert("Gagal menghapus semua favorit.")}}async handleExportFavorites(){try{const e=await this.model.getFavorites();if(e.length===0){this.view.showAlert("Tidak ada favorit untuk diekspor.");return}const t={exportDate:new Date().toISOString(),totalFavorites:e.length,favorites:e.map(i=>({id:i.id,name:i.name||i.title,description:i.description,location:i.lat&&i.lon?`${i.lat}, ${i.lon}`:null,createdAt:i.createdAt,addedToFavoritesAt:i.addedAt,photoUrl:i.photoUrl}))},a=`story-explorer-favorites-${new Date().toISOString().split("T")[0]}.json`;this.view.downloadFile(t,a),this.view.showSuccessMessage("Favorit berhasil diekspor.")}catch(e){console.error("Error exporting favorites:",e),this.view.showAlert("Gagal mengekspor favorit.")}}destroy(){}}export{o as FavoritesPresenter};
