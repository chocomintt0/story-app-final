import{L as a}from"./leaflet-src-BSbcx_7H.js";class n{constructor(t,e){this.model=t,this.view=e,this.map=null}async init(){this.view.onStoryCardClick(t=>this.handleStoryClick(t)),this.view.onAddToFavorites(t=>this.handleAddToFavorites(t)),await this.loadStories(),setTimeout(()=>{this.initMap(),this.updateFavoriteButtonStates()},100)}async loadStories(){try{this.view.showLoading();const t=await this.model.getAllStories();this.view.renderStories(t)}catch(t){console.error("Error loading stories:",t),this.view.showError("Gagal memuat cerita. Silakan coba lagi nanti.")}}async updateFavoriteButtonStates(){const t=this.model.stories||[];for(const e of t){const i=await this.model.isFavorite(e.id);this.view.updateFavoriteButton(e.id,i)}}async handleStoryClick(t){try{const e=await this.model.getStoryById(t);e&&this.view.showStoryDetail(e)}catch(e){console.error("Error fetching story details:",e),this.view.showAlert("Gagal memuat detail cerita.")}}async handleAddToFavorites(t){try{const e=await this.model.getStoryById(t);e&&(await this.model.isFavorite(t)?(await this.model.removeFromFavorites(t),this.view.showSuccessMessage("Cerita dihapus dari favorit!"),this.view.updateFavoriteButton(t,!1)):(await this.model.addToFavorites(e),this.view.showSuccessMessage("Cerita ditambahkan ke favorit!"),this.view.updateFavoriteButton(t,!0)))}catch(e){console.error("Error managing favorites:",e),this.view.showAlert("Gagal memperbarui favorit.")}}initMap(){if(!this.view.getMapContainer()){console.error("Map container not found");return}try{this.map=a.map("home-map").setView([-6.2,106.8],6);const e=a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}),i=a.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"© Esri"});e.addTo(this.map);const r={OpenStreetMap:e,Satelit:i};a.control.layers(r).addTo(this.map),this.addStoryMarkers()}catch(e){console.error("Error initializing map:",e)}}addStoryMarkers(){!this.map||!this.model.stories||this.model.stories.forEach(t=>{if(t.lat&&t.lon){const e=a.marker([t.lat,t.lon]).addTo(this.map),i=this.view.createPopupContent(t);e.bindPopup(i)}})}destroy(){this.map&&(this.map.remove(),this.map=null)}}export{n as HomePresenter};
